.model small
.stack 100h

.data
                                             ;5                                           ;10                                          ;15                                          ;20                                          25                                           30                                           35                                          ;40
level db ' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h
      db ' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h ;5
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,'$',00Eh,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h ;10
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,'S',00Eh,'C',00Eh,'O',00Eh,'R',00Eh,'E',00Eh,':',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',000h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',000h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h ;15
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,'$',00Eh,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h ;20
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h
      db ' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h ;25
                                                                                                                                                                                                                     
    baseLevel db 2000 dup(?) 
  
    PacmanPositionX dw 2     ;Pacman coordinates
    PacmanPositionY dw 22  
    direction dw 2 ;1 - up ;2 - right ;3 - down ;4 - left
                   
    score1 db 0     ;first digit of score
    score2 db 0     ;second dogit of score
    scoreLeft dw 76 ;amount of '$'
    
    M1PositionX dw 2 ;Monster Coordinates
    M1PositionY dw 1
    M1direction dw 2
    M1Cycle dw 74 ;every monster has a cyclic path
                  ;this path consists of 74 moves
    M2PositionX dw 72
    M2PositionY dw 21
    M2direction dw 1
    M2Cycle dw 128
    
    M3PositionX dw 24
    M3PositionY dw 8
    M3direction dw 2
    M3Cycle dw 142
          
.code 
;.startup
;.386 
jmp main

DisplayCleanScreen proc
    mov bx, 0                                
    mov ah, 00   ;set video mode 40x25
    mov al, 01 
    int 10h
    
    mov ax, 0B800h;video memory address
    mov es, ax
    
    mov cx, 1000
    mov bx, 0
Outp:
    mov es:bx, ' ' ;black screen
    inc bx
    mov es:bx, 088h
    inc bx
loop Outp  
ret
DisplayCleanScreen endp  
   
   
DisplayStart proc
    
    push ds
    
    mov bx, 0
    mov ah, 00 ;video mode
    mov al, 01
    int 10h
    
    mov ax, 0B800h
    mov ds, ax
    
    call DisplayCleanScreen 
    
    mov ds:[194],'P'
    mov ds:[195],00001110b ;00001 - > bright 
    mov ds:[196],'A'       ;  111 - > yellow
    mov ds:[197],00001110b
    mov ds:[198],'C'
    mov ds:[199],00001110b
    mov ds:[200],'-'
    mov ds:[201],00001110b
    mov ds:[202],'M'
    mov ds:[203],00001110b
    mov ds:[204],'A'
    mov ds:[205],00001110b 
    mov ds:[206],'N'
    mov ds:[207],00001110b
    
    mov ds:[346],'C'
    mov ds:[347],00001111b
    mov ds:[348],'o'
    mov ds:[349],00001111b
    mov ds:[350],'n'
    mov ds:[351],00001111b
    mov ds:[352],'t'
    mov ds:[353],00001111b
    mov ds:[354],'r'
    mov ds:[355],00001111b
    mov ds:[356],'o'
    mov ds:[357],00001111b
    mov ds:[358],'l'
    mov ds:[359],00001111b
    mov ds:[360],'s'
    mov ds:[361],00001111b
    mov ds:[362],':'
    mov ds:[363],00001111b 
    
    mov ds:[506],'A'
    mov ds:[507],00000111b
    mov ds:[508],'-'
    mov ds:[509],00000111b
    mov ds:[510],'U'
    mov ds:[511],00000111b
    mov ds:[512],'P'
    mov ds:[513],00000111b
    
    mov ds:[666],'D'
    mov ds:[667],00000111b
    mov ds:[668],'-'
    mov ds:[669],00000111b
    mov ds:[670],'D'
    mov ds:[671],00000111b
    mov ds:[672],'O'
    mov ds:[673],00000111b
    mov ds:[674],'W'
    mov ds:[675],00000111b
    mov ds:[676],'N'
    mov ds:[677],00000111b
    
    mov ds:[826],'L'
    mov ds:[827],00000111b
    mov ds:[828],'-'
    mov ds:[829],00000111b
    mov ds:[830],'L'
    mov ds:[831],00000111b
    mov ds:[832],'E'
    mov ds:[833],00000111b
    mov ds:[834],'F'
    mov ds:[835],00000111b
    mov ds:[836],'T'
    mov ds:[837],00000111b
    
    mov ds:[986],'R'
    mov ds:[987],00000111b
    mov ds:[988],'-'
    mov ds:[989],00000111b
    mov ds:[990],'R'
    mov ds:[991],00000111b
    mov ds:[992],'I'
    mov ds:[993],00000111b
    mov ds:[994],'G'
    mov ds:[995],00000111b
    mov ds:[996],'H'
    mov ds:[997],00000111b
    mov ds:[998],'T'
    mov ds:[999],00000111b 
    
    mov ds:[1146],'E'
    mov ds:[1147],00000111b
    mov ds:[1148],'N'
    mov ds:[1149],00000111b
    mov ds:[1150],'T'
    mov ds:[1151],00000111b
    mov ds:[1152],'E'
    mov ds:[1153],00000111b
    mov ds:[1154],'R'
    mov ds:[1155],00000111b
    mov ds:[1156],'-'
    mov ds:[1157],00000111b
    mov ds:[1158],'S'
    mov ds:[1159],00000111b
    mov ds:[1160],'T'
    mov ds:[1161],00000111b
    mov ds:[1162],'A'
    mov ds:[1163],00000111b
    mov ds:[1164],'R'
    mov ds:[1165],00000111b
    mov ds:[1166],'T'
    mov ds:[1167],00000111b
    
    xor bh, bh
    mov dh, 25  ;set cursor to the end of screen
    mov ah, 02
    int 10h
    
    pop ds 

WaitStart:
    call Clear ;(buffer)
    call Pause   
    
    mov ah, 0
    int 16h  ;read (wait) key from keyboard
    cmp al, 0Dh ;esc
    je start
    cmp al, 01Bh ;enter      
    je Exit
    jne WaitStart       
    ret
DisplayStart endp
   
DisplayLose proc    
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayScore
    call Pause 
     
    push ds
    
    mov bx, 0
    mov ah, 00
    mov al, 01
    int 10h
    
    mov ax, 0B800h
    mov ds, ax
    
    call DisplayCleanScreen 
    
    mov ds:[194],'Y'
    mov ds:[195],00001110b ;00001 - > bright 
    mov ds:[196],'O'       ;  110 - > yellow
    mov ds:[197],00001110b
    mov ds:[198],'U'
    mov ds:[199],00001110b
    
    mov ds:[352],'L'
    mov ds:[353],00001110b
    mov ds:[354],'O'
    mov ds:[355],00001110b
    mov ds:[356],'S'
    mov ds:[357],00001110b
    mov ds:[358],'E'
    mov ds:[359],00001110b
    mov ds:[360],'!'    
    mov ds:[361],00001110b 
    mov ds:[362],'!'    
    mov ds:[363],00001110b 
     
    xor bh, bh
    mov dh, 25  ;set cursor to the end of screen
    mov ah, 02
    int 10h
    
    pop ds 

WaitLose:
    call Clear ;(buffer)
    call Pause      
    mov ah, 0
    int 16h  ;read (wait) key from keyboard
    cmp al, 01Bh ;esc
    je Exit
    jne nextLose
    ret     
    
nextLose:
    cmp al, 0Dh ;enter
    jne WaitLose           
    call DisplayCleanScreen
    jmp start ;you can start a new game after lose               
                    
    ret
DisplayLose endp 

DisplayWin proc   
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayPacman
    call DisplayScore
    call Pause 
   
    push ds
    
    mov bx, 0
    mov ah, 00
    mov al, 01
    int 10h
    
    mov ax, 0B800h
    mov ds, ax
    
    call DisplayCleanScreen 
    
    mov ds:[194],'Y'
    mov ds:[195],00001110b ;00001 - > bright 
    mov ds:[196],'O'       ;  110 - > yellow
    mov ds:[197],00001110b
    mov ds:[198],'U'
    mov ds:[199],00001110b
    
    mov ds:[352],'W'
    mov ds:[353],00001110b
    mov ds:[354],'I'
    mov ds:[355],00001110b
    mov ds:[356],'N'
    mov ds:[357],00001110b
    mov ds:[358],'!'
    mov ds:[359],00001110b
    mov ds:[360],'!'    
    mov ds:[361],00001110b 
    mov ds:[362],'!'    
    mov ds:[363],00001110b 
     
    xor bh, bh
    mov dh, 25 
    mov ah, 02 ;set cursor to the end of screen
    int 10h
    
    pop ds 

WaitWin:
    mov ah,0
    int 16h    
    cmp al,0Dh;enter
    jne WaitWin
    je Start    
    ret
DisplayWin endp
 
DisplayLevel proc    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
       
    mov bx,0
    mov ah,00  ;video mode
    mov al,01
    int 10h 
    
    mov ax,0B800h
    mov es,ax
    mov di,0
        
    mov si,offset level
    mov cx,2000 
    cld ;set DF to 0(for correct processing of strings)  
    rep movsb ;si->di 
    ret  
DisplayLevel endp

DisplayScore proc
    mov dl, score1
    mov dh, score2			  		
    add dl, '0'
    add dh, '0'

    push ds
    
    mov ax, 0B800h
    mov ds, ax
    
    mov ds:[924],dl
	mov ds:[925],00001110b
	mov ds:[926],dh
	mov ds:[927],00001110b 
	
	xor bh, bh
    mov dh, 25
    mov ah, 02  ;set cursor to the end of screen
    int 10h
	
	pop ds
    ret
DisplayScore endp

Position macro Y, X ; 80*Y + X -> number of coordianate (1 of 2000)
    mov bx, offset Y
    mov ax, [bx]
    mov cl, 80                   
    mul cl                      
    mov bx, offset X
    mov cx, [bx]
    add ax, cx
    mov bx, ax 
endm
 
DisplayPacman proc
    push ds
      
    Position PacmanPositionY, PacmanPositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 01h  ;smile
    inc bx
    mov byte ptr[bx], 00001110b    
    
    xor bh, bh 
    mov dh, 25
    mov ah, 02 ;set cursor to the end of screen
    int 10h
    
    pop ds     
    ret
DisplayPacman endp

DisplayM1 proc
    push ds
      
    Position M1PositionY, M1PositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 02h  ;smile
    inc bx
    mov byte ptr[bx], 00001101b   
    
    xor bh, bh
    mov dh, 25
    mov ah, 02 ;set cursor to the end of screen
    int 10h
    
    pop ds     
    ret
DisplayM1 endp   

DisplayM2 proc
    push ds
      
    Position M2PositionY, M2PositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 02h  ;smile
    inc bx
    mov byte ptr[bx], 00001101b    
    
    xor bh, bh
    mov dh, 25 ;set cursor to the end of screen
    mov ah, 02
    int 10h
    
    pop ds     
    ret
DisplayM2 endp

DisplayM3 proc
    push ds
      
    Position M3PositionY, M3PositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 02h  ;smile
    inc bx
    mov byte ptr[bx], 00001101b
    
    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
    
    pop ds
     
    ret
DisplayM3 endp
 
Pause proc    
    push si    
    mov si, 3
    mov ah, 0 ;
    int 1Ah   ;ah-0 ->read time to dx   
    mov bx, dx
    add bx, si
Stay:
    int 1Ah
    cmp dx, bx
    jl Stay
    pop si
    ret
Pause endp 

Clear proc
    cli       ;disable interrupts
    sub ax, ax
    mov es, ax
    mov al, es:[41Ah] ;head and tail of keyboard buf
    mov es:[41Ch], al
    sti
    ret       ;enable interrupts
Clear endp 
 
MovePacman proc
    push ds
    mov si, offset level ; set map to delete '$' after 'eating' them
MoveUp:     
    Position PacmanPositionY, PacmanPositionX ;bx -> coordinate of pacman
    inc bx 
    cmp direction, 1      ;move up   
    jne MoveRight
    cmp [bx-80], 000h     ;it is way
    je CanMoveU
    cmp [bx-80], 00Eh     ;it is '$'
    jne SkipMove  
    call AddScore 
    mov [si+bx-81], ' '   ;clean '$' after 'eating'
    mov [si+bx-80], 000h  ;set color to black
CanMoveU:                 ;the algorithm is the same for other directions
    sub PacmanPositionY, 1
    jmp SkipMove 
    
MoveRight:
    cmp direction, 2         
    jne MoveDown
    cmp [bx+2], 000h
    je CanMoveR
    cmp [bx+2], 00Eh
    jne SkipMove
    call AddScore
    mov [si+bx+1], ' '
    mov [si+bx+2], 000h   
CanMoveR:
    add PacmanPositionX, 2
    jmp SkipMove   
    
MoveDown:
    cmp direction, 3         
    jne MoveLeft
    cmp [bx+80], 000h
    je  CanMoveD
    cmp [bx+80], 00Eh
    jne SkipMove
    call AddScore 
    mov [si+bx+79], ' '
    mov [si+bx+80], 000h 
CanMoveD:
    inc PacmanPositionY
    jmp SkipMove     
    
MoveLeft:
    cmp direction, 4         
    jne SkipMove
    cmp [bx-2], 000h
    je CanMoveL
    cmp [bx-2], 00Eh
    jne SkipMove
    call AddScore
    mov [si+bx-3], ' '
    mov [si+bx-2], 000h   
CanMoveL:
    sub PacmanPositionX, 2
    jmp SkipMove   
    
SkipMove: 
    call CheckDeath 
    pop ds
    ret
MovePacman endp     

CheckDeath proc
    Position PacmanPositionY, PacmanPositionX ;bx -> coordinate of Pacman 
    mov dx, bx ;save Pacman coordiante to dx
    Position M1PositionY, M1PositionX ;bx -> coordinate of Monster1
    cmp dx, bx ;if monster and pacman have the same coordinates
    je DisplayLose 
    
    Position M2PositionY, M2PositionX
    cmp dx, bx
    je DisplayLose
    
    Position M3PositionY, M3PositionX
    cmp dx, bx
    je DisplayLose
    ret
CheckDeath endp    

 
MoveM1 proc
    dec M1Cycle ;decrease cycle (how many moves of the cycle left)     
M1MoveUP:       
    cmp M1direction, 1
    jne M1MoveRight
    sub M1PositionY, 1   
M1MoveRight:        
    cmp M1direction, 2
    jne M1MoveDown
    add M1PositionX, 2   
M1MoveDown: 
    cmp M1direction, 3
    jne M1MoveLeft 
    add M1PositionY, 1  
M1MoveLeft:
    cmp M1direction, 4
    jne M1Dir
    sub M1PositionX, 2    
M1Dir: 
    cmp M1Cycle, 0   ;cycle is over, update it
    jne M1Next
    mov M1Cycle, 74
    mov M1direction, 2
    jmp M1End
M1Next:
    cmp M1Cycle, 68  ;for this step change direction
    je M1Change3     ;and so on..
    cmp M1Cycle, 66
    je M1Change2    
    cmp M1Cycle, 59
    je M1Change3     
    cmp M1Cycle, 54
    je M1Change4   
    cmp M1Cycle, 52
    je M1Change3    
    cmp M1Cycle, 43
    je M1Change2    
    cmp M1Cycle, 41
    je M1Change3   
    cmp M1Cycle, 37
    je M1Change4    
    cmp M1Cycle, 26
    je M1Change1    
    cmp M1Cycle, 23
    je M1Change4    
    cmp M1Cycle, 21
    je M1Change1   
    cmp M1Cycle, 15
    je M1Change2    
    cmp M1Cycle, 13
    je M1Change1    
    cmp M1Cycle, 7
    je M1Change4    
    cmp M1Cycle, 5
    jne M1End
M1Change1:
    mov M1direction, 1
    jmp M1End
M1Change2:
    mov M1direction, 2
    jmp M1End
M1Change3:
    mov M1direction, 3
    jmp M1End
M1Change4:    
    mov M1direction, 4    
M1End:
    ret 
MoveM1 endp


MoveM2 proc
    dec M2Cycle     
M2MoveUP:       
    cmp M2direction, 1
    jne M2MoveRight
    sub M2PositionY, 1   
M2MoveRight:        
    cmp M2direction, 2
    jne M2MoveDown
    add M2PositionX, 2   
M2MoveDown: 
    cmp M2direction, 3
    jne M2MoveLeft 
    add M2PositionY, 1  
M2MoveLeft:
    cmp M2direction, 4
    jne M2Dir
    sub M2PositionX, 2
    
M2Dir: 
    cmp M2Cycle, 0
    jne M2Next
    mov M2Cycle, 128
    mov M2direction, 1
    jmp M2End
M2Next:
    cmp M2Cycle, 126
    je M2Change4    
    cmp M2Cycle, 124
    je M2Change1   
    cmp M2Cycle, 110
    je M2Change2   
    cmp M2Cycle, 108
    je M2Change1     
    cmp M2Cycle, 106
    je M2Change4    
    cmp M2Cycle, 102
    je M2Change1    
    cmp M2Cycle, 100
    je M2Change4    
    cmp M2Cycle, 94
    je M2Change3    
    cmp M2Cycle, 92
    je M2Change4    
    cmp M2Cycle, 91
    je M2Change3    
    cmp M2Cycle, 86
    je M2Change4    
    cmp M2Cycle, 75
    je M2Change1    
    cmp M2Cycle, 70
    je M2Change4   
    cmp M2Cycle, 63
    je M2Change3   
    cmp M2Cycle, 58
    je M2Change4         
    cmp M2Cycle, 56
    je M2Change3    
    cmp M2Cycle, 45
    je M2Change4     
    cmp M2Cycle, 43
    je M2Change3    
    cmp M2Cycle, 41
    je M2Change2    
    cmp M2Cycle, 37
    je M2Change3    
    cmp M2Cycle, 35
    je M2Change2   
    cmp M2Cycle, 29
    je M2Change1   
    cmp M2Cycle, 27
    je M2Change2        
    cmp M2Cycle, 14
    je M2Change3    
    cmp M2Cycle, 12
    je M2Change2     
    cmp M2Cycle, 6
    je M2Change1    
    cmp M2Cycle, 4
    je M2Change2
    jne M2End
M2Change1:
    mov M2direction, 1
    jmp M2End
M2Change2:
    mov M2direction, 2
    jmp M2End
M2Change3:
    mov M2direction, 3
    jmp M2End
M2Change4:    
    mov M2direction, 4
    
M2End:
    ret 
MoveM2 endp  
 
 
MoveM3 proc
    dec M3Cycle     
M3MoveUP:       
    cmp M3direction, 1
    jne M3MoveRight
    sub M3PositionY, 1   
M3MoveRight:        
    cmp M3direction, 2
    jne M3MoveDown
    add M3PositionX, 2   
M3MoveDown: 
    cmp M3direction, 3
    jne M3MoveLeft 
    add M3PositionY, 1  
M3MoveLeft:
    cmp M3direction, 4
    jne M3Dir
    sub M3PositionX, 2    
M3Dir: 
    cmp M3Cycle, 0
    jne M3Next
    mov M3Cycle, 142
    mov M3direction, 1
    jmp M3End
M3Next:
    cmp M3Cycle, 133
    je M3Change4   
    cmp M3Cycle, 131
    je M3Change1    
    cmp M3Cycle, 126
    je M3Change2   
    cmp M3Cycle, 119
    je M3Change3     
    cmp M3Cycle, 114
    je M3Change2    
    cmp M3Cycle, 112
    je M3Change1    
    cmp M3Cycle, 109
    je M3Change2    
    cmp M3Cycle, 107
    je M3Change3    
    cmp M3Cycle, 106
    je M3Change2    
    cmp M3Cycle, 104
    je M3Change1    
    cmp M3Cycle, 99
    je M3Change4    
    cmp M3Cycle, 68
    je M3Change3    
    cmp M3Cycle, 66
    je M3Change2    
    cmp M3Cycle, 59
    je M3Change3    
    cmp M3Cycle, 54
    je M3Change4         
    cmp M3Cycle, 52
    je M3Change3    
    cmp M3Cycle, 43
    je M3Change2     
    cmp M3Cycle, 41
    je M3Change3    
    cmp M3Cycle, 37
    je M3Change4    
    cmp M3Cycle, 36
    je M3Change3    
    cmp M3Cycle, 34
    je M3Change2    
    cmp M3Cycle, 15
    je M3Change1    
    cmp M3Cycle, 13
    je M3Change4         
    cmp M3Cycle, 6
    je M3Change1    
    cmp M3Cycle, 2
    je M3Change2
    jne M3End
M3Change1:
    mov M3direction, 1
    jmp M3End
M3Change2:
    mov M3direction, 2
    jmp M3End
M3Change3:
    mov M3direction, 3
    jmp M3End
M3Change4:    
    mov M3direction, 4    
M3End:
    ret 
MoveM3 endp      
    
AddScore proc 
    dec scoreLeft ;how many '$' are left on the map
    cmp scoreLeft, 0 ;if every '$' was collected
    je DisplayWin
    cmp score2, 9
    je AddTen               
    inc score2
    jmp EndAddScore
AddTen:    
    mov score2, 0
    inc score1
    jmp EndAddScore
        
EndAddScore:   
    ret 
AddScore endp 

main:;;;;;;;;;;;;;;;;;;;;;;Main starts hear 
    mov ax, @data
    mov ds, ax  
        
    mov cx,2000;40 * 25 = 1000 ;;; 1000*2 = 2000 (Video symbol consists of two parts: symbol and attribute)
    mov si,0
copy:;;;;;;;;;;;;;;;;;;;;;;Copy level(map) to buf to set it again after win(lose) 
    mov bx,offset level
    mov ah,[bx+si]
    mov bx,offset baseLevel
    mov [bx+si],ah
    inc si
loop copy 
     
    call DisplayStart;;;;;;Start Menu
      
start:;;;;;;;;;;;;;;;;;;;;;Each new game (after win/lose) starts from this
    mov cx,2000
    mov si,0
copy2:;;;;;;;;;;;;;;;;;;;;;Renew level(map)  
    mov bx,offset baseLevel
    mov ah,[bx+si]
    mov bx,offset level
    mov [bx+si],ah
    inc si
loop copy2
            
    mov PacmanPositionX, 2    ;;;;;;;;;;;;;;;;;;;;;Update all variables for a new game
    mov PacmanPositionY, 23         
    mov direction, 2 ;1 - up ;2 - right ;3 - down ;4 - left                                                       
                   
    mov score1, 0
    mov score2, 0
    mov scoreLeft, 76
    
    mov M1PositionX, 2
    mov M1PositionY, 1
    mov M1direction, 2
    mov M1Cycle, 74
    
    mov M2PositionX, 72
    mov M2PositionY, 21
    mov M2direction, 1
    mov M2Cycle, 128
    
    mov M3PositionX, 54
    mov M3PositionY, 17
    mov M3direction, 1 
    mov M3Cycle, 142 
     
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayPacman
    call DisplayScore  
           
Game:
    jmp WaitInput  
    IsInput:
    call MovePacman
    call MoveM1
    call MoveM2
    call MoveM3
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayPacman
    call DisplayScore
    call CheckDeath
    call Pause  
    jmp Game   
    
UpEntered:
    Position PacmanPositionY, PacmanPositionX
    inc bx
    cmp [bx-80], 066h
    je EndOfInput
    mov direction, 1
    call Clear
    jmp IsInput  
    
RightEntered:
    Position PacmanPositionY, PacmanPositionX
    inc bx
    cmp [bx+2], 066h
    je EndOfInput        
    mov direction, 2
    call Clear
    jmp IsInput
          
DownEntered:   
    Position PacmanPositionY, PacmanPositionX
    inc bx
    cmp [bx+80], 066h
    je EndOfInput
    mov direction, 3
    call Clear
    jmp IsInput         
          
LeftEntered:
    Position PacmanPositionY, PacmanPositionX
    inc bx
    cmp [bx-2], 066h
    je EndOfInput
    mov direction, 4
    call Clear
    jmp IsInput    
   
WaitInput:    
    mov ah,01h
    int 16h
    
    cmp al,'d'     
    je RightEntered     
    cmp al,'a'         
    je LeftEntered     
    cmp al,'w'         
    je UpEntered    
    cmp al,'s'         
    je DownEntered     
    cmp al, 01Bh  ;esc key
    je Exit
 
EndOfInput:
    call Clear
    jmp IsInput    
     
Exit:   
    mov ax, 4C00h
    int 21h
end main