.model small
.stack 100h

.data
                                             ;5                                           ;10                                          ;15                                          ;20                                          25                                           30                                           35                                          ;40
level db ' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h
      db ' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h ;5
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,'$',00Eh,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h ;10
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',000h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',000h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h ;15
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h
      db ' ',066h,'$',00Eh,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h,' ',000h,' ',066h,' ',000h,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h ;20
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,'$',00Eh,' ',066h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,'$',00Eh,' ',000h,' ',000h,' ',066h,'$',00Eh,' ',066h
      db ' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',000h,' ',066h
      db ' ',066h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',000h,' ',066h
      db ' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h,' ',066h ;25
                                                                                                                                                                                                                     
    baseLevel db 2000 dup(?) 
  
    PackmanPositionX dw 2
    PackmanPositionY dw 22  
    direction dw 2 ;1 - up
                   ;2 - right
                   ;3 - down
                   ;4 - left 
                   
    score1 db 0
    score2 db 0
    scoreLeft dw 76
    
    M1PositionX dw 2
    M1PositionY dw 1
    M1direction dw 2
    
    M2PositionX dw 72
    M2PositionY dw 21
    M2direction dw 1
    
    M3PositionX dw 24
    M3PositionY dw 8
    M3direction dw 2
          
.code 
;.startup
;.386 
jmp main

DisplayCleanScreen proc
    mov bx, 0                                
    mov ah, 00   ;set video mode
    mov al, 01   ;40x25 - 16 colors
    int 10h
    
    mov ax, 0B800h
    mov es, ax
    
    mov cx, 1000
    mov bx, 0
Outp:
    mov es:bx, ' '
    inc bx
    mov es:bx, 088h
    inc bx
loop Outp  
ret
DisplayCleanScreen endp  
   
   
DisplayStart proc    
    push ax
    push bx
    push cx
    push ds
    
    mov bx, 0
    mov ah, 00
    mov al, 01
    int 10h
    
    mov ax, 0B800h
    mov ds, ax
    
    call DisplayCleanScreen 
    
    mov ds:[194],'P'
    mov ds:[195],00001110b ;00001 - > bright 
    mov ds:[196],'A'       ;  111 - > yellow
    mov ds:[197],00001110b
    mov ds:[198],'C'
    mov ds:[199],00001110b
    mov ds:[200],'-'
    mov ds:[201],00001110b
    mov ds:[202],'M'
    mov ds:[203],00001110b
    mov ds:[204],'A'
    mov ds:[205],00001110b 
    mov ds:[206],'N'
    mov ds:[207],00001110b
    
    mov ds:[346],'C'
    mov ds:[347],00001111b
    mov ds:[348],'o'
    mov ds:[349],00001111b
    mov ds:[350],'n'
    mov ds:[351],00001111b
    mov ds:[352],'t'
    mov ds:[353],00001111b
    mov ds:[354],'r'
    mov ds:[355],00001111b
    mov ds:[356],'o'
    mov ds:[357],00001111b
    mov ds:[358],'l'
    mov ds:[359],00001111b
    mov ds:[360],'s'
    mov ds:[361],00001111b
    mov ds:[362],':'
    mov ds:[363],00001111b 
    
    mov ds:[506],'A'
    mov ds:[507],00000111b
    mov ds:[508],'-'
    mov ds:[509],00000111b
    mov ds:[510],'U'
    mov ds:[511],00000111b
    mov ds:[512],'P'
    mov ds:[513],00000111b
    
    mov ds:[666],'D'
    mov ds:[667],00000111b
    mov ds:[668],'-'
    mov ds:[669],00000111b
    mov ds:[670],'D'
    mov ds:[671],00000111b
    mov ds:[672],'O'
    mov ds:[673],00000111b
    mov ds:[674],'W'
    mov ds:[675],00000111b
    mov ds:[676],'N'
    mov ds:[677],00000111b
    
    mov ds:[826],'L'
    mov ds:[827],00000111b
    mov ds:[828],'-'
    mov ds:[829],00000111b
    mov ds:[830],'L'
    mov ds:[831],00000111b
    mov ds:[832],'E'
    mov ds:[833],00000111b
    mov ds:[834],'F'
    mov ds:[835],00000111b
    mov ds:[836],'T'
    mov ds:[837],00000111b
    
    mov ds:[986],'R'
    mov ds:[987],00000111b
    mov ds:[988],'-'
    mov ds:[989],00000111b
    mov ds:[990],'R'
    mov ds:[991],00000111b
    mov ds:[992],'I'
    mov ds:[993],00000111b
    mov ds:[994],'G'
    mov ds:[995],00000111b
    mov ds:[996],'H'
    mov ds:[997],00000111b
    mov ds:[998],'T'
    mov ds:[999],00000111b 
    
    mov ds:[1146],'E'
    mov ds:[1147],00000111b
    mov ds:[1148],'N'
    mov ds:[1149],00000111b
    mov ds:[1150],'T'
    mov ds:[1151],00000111b
    mov ds:[1152],'E'
    mov ds:[1153],00000111b
    mov ds:[1154],'R'
    mov ds:[1155],00000111b
    mov ds:[1156],'-'
    mov ds:[1157],00000111b
    mov ds:[1158],'S'
    mov ds:[1159],00000111b
    mov ds:[1160],'T'
    mov ds:[1161],00000111b
    mov ds:[1162],'A'
    mov ds:[1163],00000111b
    mov ds:[1164],'R'
    mov ds:[1165],00000111b
    mov ds:[1166],'T'
    mov ds:[1167],00000111b
    
    xor bh, bh
    mov dh, 25 
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax 

WaitStart:
    call Clear ;(buffer)
    call Pause   
    
    mov ah, 0
    int 16h  ;read (wait) key from keyboard
    cmp al, 0Dh ;esc
    je start
    cmp al, 01Bh ;enter      
    je Exit
    jne WaitStart       
    ret
DisplayStart endp
   
DisplayLose proc
     
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayScore
    call Pause 
     
    push ax
    push bx
    push cx
    push ds
    
    mov bx, 0
    mov ah, 00
    mov al, 01
    int 10h
    
    mov ax, 0B800h
    mov ds, ax
    
    call DisplayCleanScreen 
    
    mov ds:[194],'Y'
    mov ds:[195],00001110b ;00001 - > bright 
    mov ds:[196],'O'       ;  110 - > yellow
    mov ds:[197],00001110b
    mov ds:[198],'U'
    mov ds:[199],00001110b
    
    mov ds:[352],'L'
    mov ds:[353],00001110b
    mov ds:[354],'O'
    mov ds:[355],00001110b
    mov ds:[356],'S'
    mov ds:[357],00001110b
    mov ds:[358],'E'
    mov ds:[359],00001110b
    mov ds:[360],'!'    
    mov ds:[361],00001110b 
    mov ds:[362],'!'    
    mov ds:[363],00001110b 
     
    xor bh, bh
    mov dh, 25 
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax 

WaitLose:
    call Clear ;(buffer)
    call Pause   
    
    mov ah, 0
    int 16h  ;read (wait) key from keyboard
    cmp al, 01Bh ;esc
    je Exit
    jne nextLose
    ret     
    
nextLose:
    cmp al, 0Dh ;enter
    jne WaitLose       
    
    call DisplayCleanScreen
    jmp start                
                    
    ret
DisplayLose endp 

DisplayWin proc
    
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayPackman
    call DisplayScore
    call Pause 
   
    push ax
    push bx
    push cx
    push ds
    
    mov bx, 0
    mov ah, 00
    mov al, 01
    int 10h
    
    mov ax, 0B800h
    mov ds, ax
    
    call DisplayCleanScreen 
    
    mov ds:[194],'Y'
    mov ds:[195],00001110b ;00001 - > bright 
    mov ds:[196],'O'       ;  111 - > yellow
    mov ds:[197],00001110b
    mov ds:[198],'U'
    mov ds:[199],00001110b
    
    mov ds:[352],'W'
    mov ds:[353],00001110b
    mov ds:[354],'I'
    mov ds:[355],00001110b
    mov ds:[356],'N'
    mov ds:[357],00001110b
    mov ds:[358],'!'
    mov ds:[359],00001110b
    mov ds:[360],'!'    
    mov ds:[361],00001110b 
    mov ds:[362],'!'    
    mov ds:[363],00001110b 
     
    xor bh, bh
    mov dh, 25 
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax 

WaitWin:
    mov ah,0
    int 16h    
    cmp al,0Dh
    jne WaitWin
    je Start
    
    ret
DisplayWin endp
 
DisplayLevel proc    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
       
    mov bx,0
    mov ah,00
    mov al,01
    int 10h 
    
    mov ax,0B800h
    mov es,ax
    mov di,0
        
    mov si,offset level
    mov cx,2000 
    cld
    rep movsb ;si->di 
    ret  
DisplayLevel endp

DisplayScore proc
    mov dl, score1
    mov dh, score2			  		
    add dl, '0'
    add dh, '0'
    
    push ax
    push bx
    push cx
    push ds
    
    mov ax, 0B800h
    mov ds, ax
    
    mov ds:[912], 'S'
    mov ds:[913],  00001110b      
    mov ds:[914], 'C'
	mov ds:[915],  00001110b
    mov ds:[916], 'O'
	mov ds:[917],  00001110b
    mov ds:[918], 'R'
	mov ds:[919],  00001110b
    mov ds:[920], 'E'
	mov ds:[921],  00001110b
    mov ds:[922], ':'
	mov ds:[923],  00001110b 
    
    mov ds:[924],dl
	mov ds:[925],00001110b
	mov ds:[926],dh
	mov ds:[927],00001110b 
	
	xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
	
	pop ds
    pop cx
    pop bx
    pop ax
    ret
DisplayScore endp

Position macro Y, X
    mov bx, offset Y
    mov ax, [bx]
    mov cl, 80                   
    mul cl                      
    mov bx, offset X
    mov cx, [bx]
    add ax, cx
    mov bx, ax 
endm
 
DisplayPackman proc  
    push ax
    push bx
    push cx
    push ds
      
    ;call PackmanPosition
    Position PackmanPositionY, PackmanPositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 01h  ;smile
    inc bx
    mov byte ptr[bx], 00001110b
    
    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax
     
    ret
DisplayPackman endp

DisplayM1 proc
    push ax
    push bx
    push cx
    push ds
      
    Position M1PositionY, M1PositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 02h  ;smile
    inc bx
    mov byte ptr[bx], 00001101b
    
    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax
     
    ret
DisplayM1 endp   

DisplayM2 proc
    push ax
    push bx
    push cx
    push ds
      
    Position M2PositionY, M2PositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 02h  ;smile
    inc bx
    mov byte ptr[bx], 00001101b
    
    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax
     
    ret
DisplayM2 endp

DisplayM3 proc
    push ax
    push bx
    push cx
    push ds
      
    Position M3PositionY, M3PositionX
    mov ax, 0B800h
    mov ds, ax         
    
    mov byte ptr[bx], 02h  ;smile
    inc bx
    mov byte ptr[bx], 00001101b
    
    
    xor bh, bh
    mov dh, 25
    mov ah, 02
    int 10h
    
    pop ds
    pop cx
    pop bx
    pop ax
     
    ret
DisplayM3 endp
 
Pause proc
    
    push si
    
    mov si, 3
    mov ah, 0 ;
    int 1Ah   ;ah-0 ->read time to dx
    
    mov bx, dx
    add bx, si
Stay:
    int 1Ah
    cmp dx, bx
    ;jne Stay
    jl Stay
    pop si
    ret
Pause endp 

Clear proc
    cli       ;disable interrupts
    sub ax, ax
    mov es, ax
    mov al, es:[41Ah]
    mov es:[41Ch], al
    sti
    ret       ;enable interrupts
Clear endp 

 
MovePackman proc  
    push ax
    push bx
    push cx
    push dx
    push ds
    mov si, offset level
MoveUp:     
    Position PackmanPositionY, PackmanPositionX ;bx -> coordinate of packman
    inc bx 
    cmp direction, 1      ;move up   
    jne MoveRight
    cmp [bx-80], 000h
    je CanMoveU
    cmp [bx-80], 00Eh
    jne SkipMove  
    call AddScore 
    mov [si+bx-81], ' '
    mov [si+bx-80], 000h
CanMoveU:
    sub PackmanPositionY, 1
    jmp SkipMove 

    
MoveRight:
    cmp direction, 2         
    jne MoveDown
    cmp [bx+2], 000h
    je CanMoveR
    cmp [bx+2], 00Eh
    jne SkipMove
    call AddScore
    mov [si+bx+1], ' '
    mov [si+bx+2], 000h   
CanMoveR:
    add PackmanPositionX, 2
    jmp SkipMove
   
    
MoveDown:
    cmp direction, 3         
    jne MoveLeft
    cmp [bx+80], 000h
    je  CanMoveD
    cmp [bx+80], 00Eh
    jne SkipMove
    call AddScore 
    mov [si+bx+79], ' '
    mov [si+bx+80], 000h 
CanMoveD:
    inc PackmanPositionY
    jmp SkipMove  
   
    
MoveLeft:
    cmp direction, 4         
    jne SkipMove
    cmp [bx-2], 000h
    je CanMoveL
    cmp [bx-2], 00Eh
    jne SkipMove
    call AddScore
    mov [si+bx-3], ' '
    mov [si+bx-2], 000h   
CanMoveL:
    sub PackmanPositionX, 2
    jmp SkipMove 
  
    
SkipMove: 
    call CheckDeath 
    pop ds
    pop dx
    pop cx
    pop bx
    pop ax
    ret
MovePackman endp     

CheckDeath proc
    Position M1PositionY, M1PositionX
    mov dx, bx
    Position PackmanPositionY, PackmanPositionX
    cmp dx, bx
    je DisplayLose 
    
    Position M2PositionY, M2PositionX
    mov dx, bx
    Position PackmanPositionY, PackmanPositionX
    cmp dx, bx
    je DisplayLose
    
    Position M3PositionY, M3PositionX
    mov dx, bx
    Position PackmanPositionY, PackmanPositionX
    cmp dx, bx
    je DisplayLose
    ret
CheckDeath endp    
 
MoveM1 proc
    push ax
    push bx
    push cx
    push dx
    push ds
    
M1MoveUP:     
    Position M1PositionY, M1PositionX ;bx -> coordinate of first monster
    inc bx 
    cmp M1direction, 1      ;move up   
    jne M1MoveRight
    cmp [bx-80], 000h
    je M1CanU
    cmp [bx-80], 00Eh
    jne M1Dir12   
M1CanU:
    sub M1PositionY, 1
    jmp M1SkipMove 
    
M1MoveRight:
    cmp M1direction, 2         
    jne M1MoveDown
    cmp M1[bx+2], 000h
    je M1CanR
    cmp M1[bx+2], 00Eh
    jne M1Dir23     
M1CanR:
    add M1PositionX, 2
    jmp M1SkipMove
    
M1MoveDown:
    cmp M1direction, 3         
    jne M1MoveLeft
    cmp [bx+80], 000h
    je M1CanD  
    cmp [bx+80], 00Eh
    jne M1Dir34  
M1CanD:
    inc M1PositionY
    jmp M1SkipMove  
    
M1MoveLeft:
    cmp M1direction, 4         
    jne M1SkipMove
    cmp [bx-2], 000h
    je M1CanL
    cmp [bx-2], 00Eh
    jne M1Dir41    
M1CanL:
    sub M1PositionX, 2
    jmp M1SkipMove     
    
M1Dir12:
    mov M1direction, 2
    jmp M1MoveRight 
    
M1Dir23:
    mov M1direction, 3
    jmp M1MoveDown
    
M1Dir34:
    mov M1direction, 4
    jmp M1MoveLeft
 
M1Dir41:
    mov M1direction, 1
    jmp M1MoveUp 
    
M1SkipMove: 
    
    pop ds
    pop dx
    pop cx
    pop bx
    pop ax
    ret 
MoveM1 endp    
 
MoveM2 proc
    push ax
    push bx
    push cx
    push dx
    push ds
    
M2MoveUP:     
    Position M2PositionY, M2PositionX ;bx -> coordinate of second monster
    inc bx 
    cmp M2direction, 1      ;move up   
    jne M2MoveRight
    cmp [bx-80], 000h
    je M2CanU
    cmp [bx-80], 00Eh
    jne M2Dir14   
M2CanU:
    sub M2PositionY, 1
    jmp M2SkipMove 
    
M2MoveRight:
    cmp M2direction, 2         
    jne M2MoveDown
    cmp M2[bx+2], 000h
    je M2CanR
    cmp M2[bx+2], 00Eh
    jne M2Dir21 
M2CanR:
    add M2PositionX, 2
    jmp M2SkipMove
    
M2MoveDown:
    cmp M2direction, 3         
    jne M2MoveLeft
    cmp [bx+80], 000h
    je M2CanD
    cmp [bx+80], 00Eh
    jne M2Dir32
M2CanD:    
    inc M2PositionY
    jmp M2SkipMove  
    
M2MoveLeft:
    cmp M2direction, 4         
    jne M2SkipMove
    cmp [bx-2], 000h
    je M2CanL 
    cmp [bx-2], 00Eh
    jne M2Dir43
M2CanL:
    sub M2PositionX, 2
    jmp M2SkipMove     
    
M2Dir14:
    mov M2direction, 4
    jmp M2MoveLeft 
    
M2Dir21:
    mov M2direction, 1
    jmp M2MoveUp
    
M2Dir32:
    mov M2direction, 2
    jmp M2MoveRight
M2Dir43:
    mov M2direction, 3
    jmp M2MoveDown 
    
M2SkipMove: 
    
    pop ds
    pop dx
    pop cx
    pop bx
    pop ax
    ret 
MoveM2 endp   

MoveM3 proc
    push ax
    push bx
    push cx
    push dx
    push ds
    
M3MoveUP:     
    Position M3PositionY, M3PositionX ;bx -> coordinate of monster 3
    inc bx 
    cmp M3direction, 1      ;move up   
    jne M3MoveRight
    cmp [bx-80], 000h
    je M3CanU
    cmp [bx-80], 00Eh
    jne M3Dir12   
M3CanU:
    sub M3PositionY, 1
    jmp M3SkipMove 
    
M3MoveRight:
    cmp M3direction, 2         
    jne M3MoveDown
    cmp M3[bx+2], 000h
    je M3CanR
    cmp M3[bx+2], 00Eh
    jne M3Dir23     
M3CanR:
    add M3PositionX, 2
    jmp M3SkipMove
    
M3MoveDown:
    cmp M3direction, 3         
    jne M3MoveLeft
    cmp [bx+80], 000h
    je M3CanD  
    cmp [bx+80], 00Eh
    jne M3Dir34  
M3CanD:
    inc M3PositionY
    jmp M3SkipMove  
    
M3MoveLeft:
    cmp M3direction, 4         
    jne M3SkipMove
    cmp [bx-2], 000h
    je M3CanL
    cmp [bx-2], 00Eh
    jne M3Dir41    
M3CanL:
    sub M3PositionX, 2
    jmp M3SkipMove     
    
M3Dir12:
    mov M3direction, 2
    jmp M3MoveRight 
    
M3Dir23:
    mov M3direction, 3
    jmp M3MoveDown
    
M3Dir34:
    mov M3direction, 4
    jmp M3MoveLeft
 
M3Dir41:
    mov M3direction, 1
    jmp M3MoveUp 
    
M3SkipMove: 
    
    pop ds
    pop dx
    pop cx
    pop bx
    pop ax
    ret 
MoveM3 endp  

AddScore proc 
    dec scoreLeft
    cmp scoreLeft, 0
    je DisplayWin
    cmp score2, 9
    je AddTen               
    inc score2
    jmp EndAddScore
AddTen:    
    mov score2, 0
    inc score1
    jmp EndAddScore
        
EndAddScore:   
    ret 
AddScore endp 


main: 
    mov ax, @data
    mov ds, ax  
        
    push cx
    push si
    push bx
    push ax
    mov cx,2000
    mov si,0
copy: 
    mov bx,offset level
    mov ah,[bx+si]
    mov bx,offset baseLevel
    mov [bx+si],ah
    inc si
loop copy 
    pop ax
    pop bx
    pop si
    pop cx 
     
    call DisplayStart
      
start:  
    push cx
    push si
    push bx
    push ax
    push ds
    mov cx,2000
    mov si,0
copy2:  
    mov bx,offset baseLevel
    mov ah,[bx+si]
    mov bx,offset level
    mov [bx+si],ah
    inc si
loop copy2
    pop ds
    pop ax
    pop bx
    pop si
    pop cx
            
    mov PackmanPositionX, 2
    mov PackmanPositionY, 23         
    mov direction, 2 ;1 - up
                   ;2 - right
                   ;3 - down
                   ;4 - left 
                   
    mov score1, 0
    mov score2, 0
    mov scoreLeft, 76
    
    mov M1PositionX, 2
    mov M1PositionY, 1
    mov M1direction, 2
    
    mov M2PositionX, 72
    mov M2PositionY, 21
    mov M2direction, 1
    
    mov M3PositionX, 24
    mov M3PositionY, 8
    mov M3direction, 2 
     
     
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayPackman
    call DisplayScore
;Move:   
    ;mov PackmanPositionX,2
    ;mov PackmanPositionY,23   
           
Game:
    jmp WaitInput  
    IsInput:
    call MovePackman
    call MoveM1
    call MoveM2
    call MoveM3
    call DisplayLevel 
    call DisplayM1
    call DisplayM2
    call DisplayM3
    call DisplayPackman
    call DisplayScore
    call CheckDeath
    call Pause  
    jmp Game
    
    
UpEntered:
    Position PackmanPositionY, PackmanPositionX
    inc bx
    cmp [bx-80], 066h
    je EndOfInput
    mov direction, 1
    call Clear
    jmp IsInput  
    
RightEntered:
    Position PackmanPositionY, PackmanPositionX
    inc bx
    cmp [bx+2], 066h
    je EndOfInput        
    mov direction, 2
    call Clear
    jmp IsInput
          
DownEntered:   
    Position PackmanPositionY, PackmanPositionX
    inc bx
    cmp [bx+80], 066h
    je EndOfInput
    mov direction, 3
    call Clear
    jmp IsInput         
          
LeftEntered:
    Position PackmanPositionY, PackmanPositionX
    inc bx
    cmp [bx-2], 066h
    je EndOfInput
    mov direction, 4
    call Clear
    jmp IsInput
    
   
WaitInput:
    
    mov ah,01h
    int 16h
    
    cmp al,'d'         ;4Dh
    je RightEntered 
    
    cmp al,'a'         ;4Bh
    je LeftEntered
     
    cmp al,'w'         ;48h
    je UpEntered
    
    cmp al,'s'         ;48h
    je DownEntered 
    
    cmp al, 01Bh
    je Exit
 
EndOfInput:
    call Clear
    jmp IsInput    
     
Exit: 
    pop ds   
    mov ax, 4C00h
    int 21h
end main